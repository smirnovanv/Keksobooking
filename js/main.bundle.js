(()=>{"use strict";const e=document.querySelector("#card").content.querySelector(".popup"),t=35.6895,r=139.69171;let o=!1;const c=L.map("map-canvas").on("load",(()=>{o=!0})).setView({lat:t,lng:r},10);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(c);const s=()=>o,a=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),d=L.marker({lat:t,lng:r},{draggable:!0,icon:a});d.addTo(c);let l=L.layerGroup([]);const i=e=>"Escape"===e.key,n=e=>{const t=document.createElement("div");t.style.zIndex="100",t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.right="0",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},u=document.querySelector("main"),f=document.querySelector("#success").content.querySelector(".success"),p=document.querySelector(".map__canvas"),h=document.querySelector("#error").content.querySelector(".error"),m=f.cloneNode(!0),v=h.cloneNode(!0),b=()=>{g()},y=e=>{i(e)&&(e.preventDefault(),g())},g=()=>{u.removeChild(m),p.style.zIndex="10",document.removeEventListener("click",b),document.removeEventListener("keydown",y)},A=()=>{q()},S=e=>{i(e)&&(e.preventDefault(),q())},k=()=>{u.insertBefore(v,u.childNodes[0]),p.style.zIndex="-1",document.addEventListener("click",A),document.addEventListener("keydown",S)},q=()=>{u.removeChild(v),p.style.zIndex="10",document.removeEventListener("click",A),document.removeEventListener("keydown",S)},E=["gif","jpg","jpeg","png"],w=document.querySelector("#avatar"),x=document.querySelector(".ad-form-header__preview").querySelector("img"),C=document.querySelector("#images"),N=document.querySelector(".ad-form__photo");w.addEventListener("change",(()=>{const e=w.files[0],t=e.name.toLowerCase();if(E.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{x.src=t.result})),t.readAsDataURL(e)}})),C.addEventListener("change",(()=>{const e=C.files[0],t=e.name.toLowerCase();if(E.some((e=>t.endsWith(e)))){const t=new FileReader,r=document.createElement("img");r.setAttribute("width","70"),r.setAttribute("height","70"),t.addEventListener("load",(()=>{r.src=t.result})),t.readAsDataURL(e),N.appendChild(r)}}));const z="1000",D="5000",j="10000",F=document.querySelector(".ad-form"),$=F.querySelectorAll("fieldset"),I=F.querySelector("#address"),T=F.querySelector("#type"),O=F.querySelector("#price"),R=F.querySelector("#timein"),U=F.querySelector("#timeout"),B=F.querySelector("#room_number"),P=F.querySelector("#capacity").querySelectorAll("option"),W=document.querySelector(".ad-form__reset");F.classList.add("ad-form--disabled"),$.forEach((e=>{e.setAttribute("disabled","")})),s()&&(F.classList.remove("ad-form--disabled"),$.forEach((e=>{e.removeAttribute("disabled")}))),I.setAttribute("readonly",""),I.value="35.6895, 139.69171";d.on("moveend",(e=>{let t=e.target.getLatLng();I.value=`${t.lat.toFixed(5)}, ${t.lng.toFixed(5)}`})),T.addEventListener("change",(()=>{"bungalow"===T.value?(O.setAttribute("min","0"),O.placeholder="0"):"flat"===T.value?(O.setAttribute("min",z),O.placeholder=z):"house"===T.value?(O.setAttribute("min",D),O.placeholder=D):"palace"===T.value&&(O.setAttribute("min",j),O.placeholder=j)})),R.addEventListener("change",(()=>{"12:00"===R.value?U.value="12:00":"13:00"===R.value?U.value="13:00":"14:00"===R.value&&(U.value="14:00")})),U.addEventListener("change",(()=>{"12:00"===U.value?R.value="12:00":"13:00"===U.value?R.value="13:00":"14:00"===U.value&&(R.value="14:00")})),B.addEventListener("change",(()=>{"1"===B.value?(P[2].removeAttribute("disabled"),P[0].setAttribute("disabled",""),P[1].setAttribute("disabled",""),P[3].setAttribute("disabled",""),P[2].setAttribute("selected",""),P[0].removeAttribute("selected"),P[1].removeAttribute("selected"),P[3].removeAttribute("selected")):"2"===B.value?(P[1].removeAttribute("disabled"),P[2].removeAttribute("disabled"),P[1].setAttribute("selected",""),P[0].setAttribute("disabled",""),P[3].setAttribute("disabled",""),P[0].removeAttribute("selected"),P[2].removeAttribute("selected"),P[3].removeAttribute("selected")):"3"===B.value?(P[0].removeAttribute("disabled"),P[1].removeAttribute("disabled"),P[2].removeAttribute("disabled"),P[0].setAttribute("selected",""),P[3].setAttribute("disabled",""),P[1].removeAttribute("selected"),P[2].removeAttribute("selected"),P[3].removeAttribute("selected")):"100"===B.value&&(P[3].removeAttribute("disabled"),P[3].setAttribute("selected",""),P[0].setAttribute("disabled",""),P[1].setAttribute("disabled",""),P[2].setAttribute("disabled",""),P[0].removeAttribute("selected"),P[1].removeAttribute("selected"),P[2].removeAttribute("selected"))}));const G=()=>{for(F.reset(),O.setAttribute("min",z),O.setAttribute("placeholder",z),P.forEach((e=>e.removeAttribute("disabled"))),P.forEach((e=>e.removeAttribute("selected"))),P[2].setAttribute("selected",""),x.src="img/muffin-grey.svg";N.firstChild;)N.removeChild(N.firstChild);d.setLatLng([t,r]),I.value="35.6895, 139.69171"},M=document.querySelector(".map__filters"),V=M.querySelectorAll("select"),H=M.querySelector("fieldset"),J=M.querySelector("#housing-type"),K=M.querySelector("#housing-price"),Q=M.querySelector("#housing-rooms"),X=M.querySelector("#housing-guests"),Y=M.querySelector("#housing-features"),Z=Y.querySelector("#filter-wifi"),ee=Y.querySelector("#filter-dishwasher"),te=Y.querySelector("#filter-parking"),re=Y.querySelector("#filter-washer"),oe=Y.querySelector("#filter-elevator"),ce=Y.querySelector("#filter-conditioner");M.classList.add("map__filters--disabled"),V.forEach((e=>{e.setAttribute("disabled","")})),H.setAttribute("disabled","");const se=t=>{l.clearLayers(),(e=>{let t=[];return e.forEach((e=>{e.offer.type!==J.value&&"any"!==J.value||e.offer.rooms!==Number(Q.value)&&"any"!==Q.value||e.offer.guests!==Number(X.value)&&"any"!==X.value||!(e.offer.price<1e4&&"low"===K.value||e.offer.price>5e4&&"high"===K.value||e.offer.price>=1e4&&e.offer.price<=5e4&&"middle"===K.value||"any"===K.value)||(Z.checked||ee.checked||te.checked||re.checked||oe.checked||ce.checked)&&!((e.offer.features.includes("elevator")&&oe.checked||!oe.checked)&&(e.offer.features.includes("wifi")&&Z.checked||!Z.checked)&&(e.offer.features.includes("dishwasher")&&ee.checked||!ee.checked)&&(e.offer.features.includes("washer")&&re.checked||!re.checked)&&(e.offer.features.includes("parking")&&te.checked||!te.checked)&&(e.offer.features.includes("conditioner")&&ce.checked||!ce.checked))||t.push(e)})),t})(t.slice()).slice(0,10).forEach((t=>{(t=>{const r=t.location.lat,o=t.location.lng,s=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),a=L.marker({lat:r,lng:o},{icon:s});a.bindPopup((t=>{const r=e.cloneNode(!0),o=Object.keys(t.offer),c=Object.keys(t.author),s=r.querySelector(".popup__features"),a=r.querySelector(".popup__photos"),d=r.querySelector(".popup__photo"),l=r.querySelector(".popup__title"),i=r.querySelector(".popup__text--address"),n=r.querySelector(".popup__text--price"),u=r.querySelector(".popup__type"),f=r.querySelector(".popup__text--capacity"),p=r.querySelector(".popup__text--time"),h=r.querySelector(".popup__description"),m=r.querySelector(".popup__avatar"),v=e=>{e.classList.add("visually-hidden")},b=function(e){return o.includes(e)};let y=s.cloneNode(!1);b("features")&&0!==t.offer.features.length?y.appendChild((e=>{let t=document.createDocumentFragment();for(let r=0;r<e.offer.features.length;r++){let o=document.createElement("li");o.classList.add("popup__feature"),e.offer.features[r].includes("wifi")&&o.classList.add("popup__feature--wifi"),e.offer.features[r].includes("dishwasher")?o.classList.add("popup__feature--dishwasher"):e.offer.features[r].includes("washer")&&o.classList.add("popup__feature--washer"),e.offer.features[r].includes("elevator")&&o.classList.add("popup__feature--elevator"),e.offer.features[r].includes("parking")&&o.classList.add("popup__feature--parking"),e.offer.features[r].includes("conditioner")&&o.classList.add("popup__feature--conditioner"),t.appendChild(o)}return t})(t)):v(y),r.replaceChild(y,s);let g=a.cloneNode(!1);return b("photos")&&0!==t.offer.photos.length?g.appendChild((e=>{let t=document.createDocumentFragment();for(let r=0;r<e.offer.photos.length;r++){let o=d.cloneNode(!0);o.src=e.offer.photos[r],t.appendChild(o)}return t})(t)):v(g),r.replaceChild(g,a),b("title")&&""!==t.offer.title?l.textContent=t.offer.title:v(l),b("address")&&""!==t.offer.address?i.textContent=t.offer.address:v(i),b("price")&&""!==t.offer.price?n.textContent=`${t.offer.price} ₽/ночь`:v(n),b("type")&&""!==t.offer.type?u.textContent=(e=>{switch(e.offer.type){case"flat":return"Квартира";case"bungalow":return"Бунгало";case"house":return"Дом";case"palace":return"Дворец"}})(t):v(u),b("rooms")&&""!==t.offer.rooms?f.textContent=`${t.offer.rooms} комнаты для ${t.offer.guests} гостей`:v(f),b("checkin")&&o.includes("checkout")&&""!==t.offer.checkin&&""!==t.offer.checkout?p.textContent=`Заезд после ${t.offer.checkin}, выезд до ${t.offer.checkout}`:v(p),b("description")&&""!==t.offer.description?h.textContent=t.offer.description:v(h),c.includes("avatar")&&""!==t.author.avatar?m.src=t.author.avatar:v(m),r})(t)),l.addLayer(a).addTo(c)})(t)}))},ae=500;var de;de=e=>{var t;se(e),t=_.debounce((()=>{se(e)}),ae),J.addEventListener("change",(()=>{t()})),(e=>{Q.addEventListener("change",(()=>{e()}))})(_.debounce((()=>{se(e)}),ae)),(e=>{X.addEventListener("change",(()=>{e()}))})(_.debounce((()=>{se(e)}),ae)),(e=>{K.addEventListener("change",(()=>{e()}))})(_.debounce((()=>{se(e)}),ae)),(e=>{Y.addEventListener("change",(()=>{e()}))})(_.debounce((()=>{se(e)}),ae)),W.addEventListener("click",(t=>{t.preventDefault(),G(),M.reset(),se(e)})),(e=>{F.addEventListener("submit",(t=>{t.preventDefault();const r=new FormData(t.target);fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:r}).then((t=>{t.ok?(G(),e(),u.insertBefore(m,u.childNodes[0]),p.style.zIndex="-1",document.addEventListener("click",b),document.addEventListener("keydown",y)):k()})).catch((()=>k()))}))})((()=>{M.reset(),se(e)}))},fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>{e.ok?(s()&&(M.classList.remove("map__filters--disabled"),V.forEach((e=>{e.removeAttribute("disabled")})),H.removeAttribute("disabled")),e.json().then((e=>{de(e)}))):n("Ошибка! Похожие объявления не были загружены.")})).catch((()=>n("Ошибка! Похожие объявления не были загружены.")))})();
//# sourceMappingURL=main.bundle.js.map